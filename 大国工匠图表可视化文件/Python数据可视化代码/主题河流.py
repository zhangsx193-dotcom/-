# -*- coding: utf-8 -*-
"""
精细化“大国工匠精神品质”主题河流图数据生成
运行：python theme_river_fine.py
依赖：pandas、jieba、openpyxl
"""
import re
import pandas as pd
import jieba

# 1. 载入上面提供的 QUALITY_BANK
QUALITY_BANK = {
    "精益求精": {
        "子维度": "极致精度",
        "权重": 1.0,
        "keywords": {
            "微米": 1.0, "μ级": 1.0, "0.01毫米": 1.0, "0.5毫米": 0.9, "1/6头发丝": 1.0,
            "零误差": 1.0, "无差错": 1.0, "毫厘不差": 1.0, "教科书标准": 0.9, "文墨精度": 1.0,
            "比头发丝细": 1.0, "0.05毫米": 1.0, "0.15毫米": 1.0, "1微米": 1.0, "1/50误差": 1.0
        }
    },
    "敬业坚守": {
        "子维度": "长期一线",
        "权重": 0.95,
        "keywords": {
            "30年": 1.0, "40年": 1.0, "35载": 1.0, "25载": 0.9, "45年": 1.0, "36载": 0.9,
            "37个春秋": 0.9, "600万张": 0.8, "60000步": 0.8, "日复一日": 0.8, "寒暑": 0.8,
            "寂寞": 0.9, "枯燥": 0.9, "一线": 0.9, "扎根": 0.9, "岗位": 0.8
        }
    },
    "创新突破": {
        "子维度": "技术攻关",
        "权重": 1.0,
        "keywords": {
            "破解": 1.0, "无人区": 1.0, "首创": 1.0, "填补空白": 1.0, "从零到一": 1.0,
            "极限": 0.9, "难题": 0.9, "攻关": 0.9, "挑战": 0.8, "突破": 0.9,
            "新高度": 0.8, "刷新": 0.8, "再造": 0.8, "颠覆": 0.9
        }
    },
    "责任担当": {
        "子维度": "使命报国",
        "权重": 0.95,
        "keywords": {
            "使命": 1.0, "报国": 1.0, "国之大者": 1.0, "国之重器": 1.0, "不受制于人": 1.0,
            "护航": 0.9, "保驾": 0.9, "守护": 0.9, "顶梁柱": 0.9, "责无旁贷": 0.9,
            "以身许国": 1.0, "虽九死犹未悔": 1.0
        }
    },
    "专注执着": {
        "子维度": "择一事终一生",
        "权重": 1.0,
        "keywords": {
            "择一事终一生": 1.0, "锲而不舍": 1.0, "始终如一": 1.0, "精益求精": 0.9,
            "沉浸": 0.9, "忘我": 0.9, "心无旁骛": 0.9, "一辈子": 0.9, "终身": 0.9,
            "匠心": 0.8, "执念": 0.8
        }
    },
    "传承育人": {
        "子维度": "传帮带",
        "权重": 0.85,
        "keywords": {
            "传承": 1.0, "教练": 1.0, "教头": 1.0, "徒弟": 1.0, "言传身教": 1.0,
            "带队": 0.9, "育人": 0.9, "薪火相传": 0.9, "青出于蓝": 0.8
        }
    },
    "团队协作": {
        "子维度": "集体攻坚",
        "权重": 0.8,
        "keywords": {
            "团队": 1.0, "协同": 1.0, "配合": 0.9, "拧螺丝": 0.9, "总装": 0.9,
            "协作": 0.9, "合力": 0.8, "群策群力": 0.8
        }
    },
    "勇挑重担": {
        "子维度": "生死无畏",
        "权重": 1.0,
        "keywords": {
            "临危": 1.0, "生死": 1.0, "刀锋": 1.0, "开路先锋": 1.0, "爆破王": 1.0,
            "直面生死": 1.0, "从不惧怕": 0.9, "千钧一发": 0.9, "虽九死": 1.0,
            "生死考验": 1.0, "禁区": 0.9, "闯": 0.8
        }
    },
    "毫厘之功": {
        "子维度": "微观操作",
        "权重": 1.0,
        "keywords": {
            "毫厘": 1.0, "微米": 1.0, "0.01毫米": 1.0, "1微米": 1.0, "1/50": 1.0,
            "头发丝": 0.9, "丝级": 0.9, "微雕": 0.9, "绣花": 0.8
        }
    },
    "千锤百炼": {
        "子维度": "反复打磨",
        "权重": 0.9,
        "keywords": {
            "千锤百炼": 1.0, "万次": 0.9, "万次攻关": 0.9, "反复": 0.9,
            "日复一日": 0.8, "周而复始": 0.8, "一遍又一遍": 0.8
        }
    },
    "精雕细刻": {
        "子维度": "艺术级加工",
        "权重": 0.95,
        "keywords": {
            "精雕细刻": 1.0, "雕刻": 0.9, "錾刻": 0.9, "镂空": 0.9, "浮雕": 0.9,
            "透雕": 0.9, "手工": 0.8, "刀尖": 0.8
        }
    },
    "极限环境": {
        "子维度": "恶劣工况",
        "权重": 0.9,
        "keywords": {
            "超低温": 1.0, "有毒": 1.0, "300米水下": 1.0, "海平面300米": 1.0,
            "黑暗": 0.9, "高压": 0.9, "烈焰": 0.9, "千度": 0.9
        }
    },
    "数字智造": {
        "子维度": "智能工艺",
        "权重": 0.85,
        "keywords": {
            "数字化": 1.0, "数控": 0.9, "0.5毫米以内": 0.9, "程序": 0.8,
            "自动": 0.8, "智能": 0.8
        }
    },
    "百万数据": {
        "子维度": "数据驱动",
        "权重": 0.8,
        "keywords": {
            "百万数据库": 1.0, "百万": 0.9, "数据库": 0.9, "10年": 0.8,
            "反复测量": 0.8
        }
    },
    "金耳朵": {
        "子维度": "感官极致",
        "权重": 0.85,
        "keywords": {
            "金耳朵": 1.0, "听音": 0.9, "哆来咪": 0.9, "音准": 0.8
        }
    },
    "火眼金睛": {
        "子维度": "目检极致",
        "权重": 0.85,
        "keywords": {
            "火眼金睛": 1.0, "一眼看出": 0.9, "目测": 0.8, "眼光": 0.8
        }
    },
    "特种材料": {
        "子维度": "材料攻关",
        "权重": 0.85,
        "keywords": {
            "殷瓦钢": 1.0, "特种钢": 1.0, "核电钢": 0.9, "航母钢": 0.9,
            "钛合金": 0.8, "复合材料": 0.8
        }
    },
    "世界巅峰": {
        "子维度": "全球领跑",
        "权重": 0.9,
        "keywords": {
            "世界之巅": 1.0, "全球第一": 1.0, "领跑": 0.9, "领先": 0.9,
            "国际": 0.8, "海外": 0.8
        }
    },
    "超级工程": {
        "子维度": "国家名片",
        "权重": 0.9,
        "keywords": {
            "超级工程": 1.0, "港珠澳大桥": 1.0, "FAST": 1.0, "航母船坞": 0.9,
            "30万吨": 0.8, "最长船坞": 0.8
        }
    },
    "非遗传承": {
        "子维度": "文化守护",
        "权重": 0.85,
        "keywords": {
            "非物质文化遗产": 1.0, "古法": 0.9, "京作": 0.9, "汝瓷": 0.9,
            "香樟木": 0.8, "清明上河图": 0.8, "织绣": 0.8
        }
    },
    "文物复活": {
        "子维度": "修复",
        "权重": 0.85,
        "keywords": {
            "起死回生": 1.0, "复活": 0.9, "补天之手": 0.9, "涅槃": 0.9,
            "重现": 0.8, "碎片": 0.8
        }
    },
    "生活细微": {
        "子维度": "微观计量",
        "权重": 0.8,
        "keywords": {
            "3克": 1.0, "药丸3克": 1.0, "分毫不差": 0.9, "层层把关": 0.8
        }
    },
    "安全底线": {
        "子维度": "零事故",
        "权重": 0.9,
        "keywords": {
            "零失误": 1.0, "安全大于天": 1.0, "滴水不漏": 0.9, "100%成功率": 0.9,
            "零缺陷": 0.9, "零故障": 0.9
        }
    },
    "高速迭代": {
        "子维度": "频次纪录",
        "权重": 0.8,
        "keywords": {
            "千余台": 0.9, "800艘": 0.8, "3000艘次": 0.8, "17名航天员": 0.9,
            "千余次爆破": 0.9
        }
    }
} # ← 把上面的字典完整粘过来即可

# 2. 读取源 Excel
df_raw = pd.read_excel("知乎名单采集.xlsx", sheet_name="Sheet1", header=None)
texts = df_raw.iloc[1:, 0].astype(str).tolist()

# 3. 权重计数函数
def fine_count(text: str):
    text = re.sub(r"\s+", "", text)
    words = jieba.lcut(text)
    res = []
    for dim, info in QUALITY_BANK.items():
        score = 0
        for w in words:
            for kw, weight in info["keywords"].items():
                if kw in w:
                    score += weight
        if score > 0:
            res.append({"dimension": dim, "score": round(score, 2)})
    return res

# 4. 逐人逐维汇总
records = []
for pid, txt in enumerate(texts, 1):
    for item in fine_count(txt):
        records.append({
            "person_id": pid,
            "dimension": item["dimension"],
            "score": item["score"]
        })

river_df = pd.DataFrame(records)

# 5. 输出
river_df.to_csv("theme_river_fine.csv", index=False, encoding="utf-8-sig")
print("已生成 theme_river_fine.csv，共 %d 行精细化数据。" % len(river_df))
